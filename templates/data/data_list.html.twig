{% extends 'base.html.twig' %}

{% block title %}Просмотр записей{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script>
        function showFormSortAndOrder() {
            var form = document.getElementById("data_list_form");
            form.style.display = "block";
            var formSubmit = document.getElementById("data_list_form_submit");
            formSubmit.scrollIntoView({
                behavior: 'smooth'
            });
        }
        function showOrHideFormSortAndOrder() {
            var form = document.getElementById("data_list_form");
            if (form.style.display === "none") {
                form.style.display = "block";
            } else {
                form.style.display = "none";
            }
            var formSubmit = document.getElementById("data_list_form_submit");
            formSubmit.scrollIntoView({
                behavior: 'smooth'
            });
        }
    </script>
{% endblock %}

{% block header %}Просмотр записей{% endblock %}

{% block content %}
    <div>
        {% if is_granted('ROLE_ADD') %}
                <a href="{{ path('edit_data') }}" class="btn-success btn mb-2">Добавить новую запись</a>
        {% endif %}
        <button class="btn btn-primary mb-2" onclick="showFormSortAndOrder()">
            Фильтрация и сортировка
        </button>
    </div>

    <table class="table table-striped table-hover table-bordered align-middle table-responsive table-sm">
        <thead class="table-secondary align-middle">
            <tr>
                <th>ID</th>
                <th>ФИО</th>
                <th>Обо мне</th>
                <th>Опыт работы</th>
                <th>Желаемая заработная плата</th>
                <th>Дата рождения</th>
                <th>Дата отправки резюме</th>
                <th>Выбранный город трудоустройства</th>
                <th>Выбранная вакансия</th>
                <th>Аватар</th>
                <th>Файл резюме</th>
                <th colspan="2">Действия</th>
            </tr>
        </thead>
        <tbody>
            {% if resumes|length != 0 %}
                {% for resume in resumes %}
                    <tr>
                        <td>{{ resume.id }}</td>
                        <td>{{ resume.getFullName() }}</td>
                        <td>{{ (resume.getAbout() ?? '') == '' ? 'Нет информации' : resume.getAbout() }}</td>
                        <td>{{ resume.getWorkExperience() }}</td>
                        <td>{{ resume.getDesiredSalary() }}</td>
                        <td>{{ resume.getBirthDate().format('d.m.Y') }}</td>
                        <td>{{ resume.getSendingDatetime().format('d.m.Y H:i:s') }}</td>
                        <td>{{ resume.getCityToWorkIn().getName() }}</td>
                        <td>{{ resume.getDesiredVacancy().getName() }}</td>
                        <td>
                            {% if resume.getAvatar() %}
                                <img src="data:image/jpeg;base64,{{ resume.getAvatar() }}" class="avatar" alt="&nbsp;Ошибка при загрузке картинки" />
                            {% else %}
                                Не установлен
                            {% endif %}
                        </td>
                        <td>
                            {% if resume.getFile() %}
                                <a href="{{ path('download_file', { id: resume.id }) }}" target="_blank" class="btn-secondary btn">Скачать</a>
                            {% else %}
                                Не прикреплён
                            {% endif %}
                        </td>
                        <td>
                            {% if is_granted('ROLE_EDIT') %}
                                <a href="{{ path('edit_data', { id: resume.id }) }}" class="btn-warning btn">Изменить</a>
                            {% else %}
                                -
                            {% endif %}
                        </td>
                        <td>
                            {% if is_granted('ROLE_DELETE') %}
                                <a href="{{ path('delete_data', { id: resume.id }) }}" class="btn-danger btn">Удалить</a>
                            {% else %}
                                -
                            {% endif %}
                        </td>
                    </tr>
                {% endfor %}
            {% else %}
                <tr>
                    <td colspan="13">Нет резюме!</td>
                </tr>
            {% endif %}
        </tbody>
    </table>

    <button class="btn btn-primary mb-2" onclick="showOrHideFormSortAndOrder()">
        Фильтрация и сортировка
    </button>
    {{ form_start(form, {
            attr: { class: 'w-75 mx-auto', style: 'display: none;', id: 'data_list_form' },
    })}}
        <div class="row m-0">
            {{ form_row(form.isFilter_id, {
                    row_attr: { class: 'input-group-text col-4' },
                    label: 'ID',
            })}}
            {{ form_row(form.filter_id_from, {
                    row_attr: { class: 'input-group col p-0' },
                    label: 'от',
                    attr: { placeholder: 0 },
            })}}
            {{ form_row(form.filter_id_to, {
                    row_attr: { class: 'input-group col p-0' },
                    label: 'до',
                    attr: { placeholder: 100 },
            })}}
            <label class="input-group-text col">(включительно)</label>
        </div>
        <div class="row m-0">
            {{ form_row(form.isFilter_fullName, {
                    row_attr: { class: 'input-group-text col-4' },
                    label: 'ФИО',
            })}}
            {{ form_row(form.filter_fullName, {
                    row_attr: { class: 'input-group col p-0' },
                    label: 'содержит',
                    attr: { placeholder: 'Текст' },
            })}}
        </div>
        <div class="row m-0">
            {{ form_row(form.isFilter_about, {
                    row_attr: { class: 'input-group-text col-4' },
                    label: 'О себе',
            })}}
            {{ form_row(form.filter_about, {
                    row_attr: { class: 'input-group col p-0' },
                    label: 'содержит',
                    attr: { placeholder: 'Текст' },
            })}}
        </div>
        <div class="row m-0">
            {{ form_row(form.isFilter_workExperience, {
                    row_attr: { class: 'input-group-text col-4' },
                    label: 'Опыт работы',
            })}}
            {{ form_row(form.filter_workExperience_from, {
                    row_attr: { class: 'input-group col p-0' },
                    label: 'от',
                    attr: { placeholder: 5 },
            })}}
            {{ form_row(form.filter_workExperience_to, {
                    row_attr: { class: 'input-group col p-0' },
                    label: 'до',
                    attr: { placeholder: 10 },
            })}}
            <label class="input-group-text col">лет (включительно)</label>
        </div>
        <div class="row m-0">
            {{ form_row(form.isFilter_desiredSalary, {
                    row_attr: { class: 'input-group-text col-4' },
                    label: 'Желаемая ЗП',
            })}}
            {{ form_row(form.filter_desiredSalary_from, {
                    row_attr: { class: 'input-group col p-0' },
                    label: 'от',
                    attr: { placeholder: 10000 },
            })}}
            {{ form_row(form.filter_desiredSalary_to, {
                    row_attr: { class: 'input-group col p-0' },
                    label: 'до',
                    attr: { placeholder: 30000 },
            })}}
            <label class="input-group-text col">рублей (включительно)</label>
        </div>
        <div class="row m-0">
            {{ form_row(form.isFilter_birthDate, {
                    row_attr: { class: 'input-group-text col-4' },
                    label: 'Дата рождения',
            })}}
            {{ form_row(form.filter_birthDate_from, {
                    row_attr: { class: 'input-group col p-0' },
                    label: 'от',
                    label_attr: { class: 'col-2 input-group-text' },
                    attr: { class: 'col' },
            })}}
            {{ form_row(form.filter_birthDate_to, {
                    row_attr: { class: 'input-group col p-0' },
                    label: 'до',
                    label_attr: { class: 'col-2 input-group-text' },
                    attr: { class: 'col' },
            })}}
        </div>
        <div class="row m-0">
            {{ form_row(form.isFilter_sendingDatetime, {
                    row_attr: { class: 'input-group-text col-4' },
                    label: 'Дата и время отправки резюме',
            })}}
            {{ form_row(form.filter_sendingDatetime_from, {
                    row_attr: { class: 'input-group col p-0' },
                    label: 'от',
                    label_attr: { class: 'col-2 input-group-text' },
                    attr: { class: 'col' },
            })}}
            {{ form_row(form.filter_sendingDatetime_to, {
                    row_attr: { class: 'input-group col p-0' },
                    label: 'до',
                    label_attr: { class: 'col-2 input-group-text' },
                    attr: { class: 'col' },
            })}}
        </div>
        <div class="row m-0">
            {{ form_row(form.isFilter_cityToWorkIn, {
                    row_attr: { class: 'input-group-text col-4' },
                    label: 'Город трудоустройства',
            })}}
            {{ form_row(form.filter_cityToWorkIn, {
                    row_attr: { class: 'input-group col p-0' },
                    label_attr: { hidden: true },
            })}}
        </div>
        <div class="row m-0">
            {{ form_row(form.isFilter_desiredVacancy, {
                    row_attr: { class: 'input-group-text col-4' },
                    label: 'Вакансия',
            })}}
            {{ form_row(form.filter_desiredVacancy, {
                    row_attr: { class: 'input-group col p-0' },
                    label_attr: { hidden: true },
            })}}
        </div>
        <div class="row m-0 mt-2">
            {{ form_row(form.sort_field, {
                    row_attr: { class: 'input-group col p-0' },
                    label: 'Сортировать по полю',
                    label_attr: { class: 'input-group-text col-6' },
            })}}
            {{ form_row(form.sort_ascOrDesc, {
                    row_attr: { class: 'input-group col p-0' },
                    label: 'в порядке',
                    label_attr: { class: 'input-group-text col-6' },
            })}}
        </div>
        <div class="row m-0">
            {{ form_row(form.records_on_page, {
                    row_attr: { class: 'input-group col p-0' },
                    label: 'Записей на странице',
                    label_attr: { class: 'input-group-text col-6' },
                    attr: { placeholder: 20 },
            })}}
            {{ form_row(form.page, {
                    row_attr: { class: 'input-group col p-0' },
                    label: 'перейти на страницу',
                    label_attr: { class: 'input-group-text col-6' },
                    attr: { placeholder: 1 },
            })}}
        </div>
        {{ form_row(form.submit, {
                label: 'Обновить',
                row_attr: { class: 'my-2' },
        })}}
    {{ form_end(form) }}
{% endblock %}
